<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>GST B2B INVOICE PORTAL</title>
    <style>
        :root { --portal-blue: #003366; --main-bg: #f0f2f5; }
        body { font-family: sans-serif; margin: 0; background: var(--main-bg); }
        header { background: var(--portal-blue); color: white; padding: 15px 5%; display: flex; justify-content: space-between; align-items: center; }
        .wrapper { display: flex; min-height: 90vh; }
        .sidebar { width: 250px; background: white; border-right: 1px solid #ddd; display: none; }
        .sidebar li { padding: 15px; border-bottom: 1px solid #eee; cursor: pointer; list-style: none; }
        .main-content { flex-grow: 1; padding: 40px; display: flex; justify-content: center; }
        .page-container { background: white; padding: 30px; border-radius: 8px; width: 100%; max-width: 700px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .hidden { display: none; }
        .form-row { margin-bottom: 15px; display: flex; align-items: center; }
        .form-row label { width: 180px; font-weight: bold; }
        .form-row input { flex: 1; padding: 10px; border: 1px solid #ccc; border-radius: 4px; }
        .btn { background: #337ab7; color: white; border: none; padding: 12px 20px; cursor: pointer; border-radius: 4px; width: 100%; }
        .card-grid { display: flex; gap: 20px; margin-bottom: 20px; }
        .card { flex: 1; background: white; padding: 20px; text-align: center; border-top: 4px solid var(--portal-blue); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    </style>
</head>
<body>

    <header>
        <h1>GST B2B INVOICE</h1>
        <button onclick="location.reload()" style="background:none; color:white; border:1px solid white; padding:5px 10px; cursor:pointer;">Home</button>
    </header>

    <div class="wrapper">
        <nav class="sidebar" id="sidebar">
            <ul>
                <li onclick="showPage('dashboard-page')">Dashboard</li>
                <li onclick="showPage('entry-page')">Create Entry</li>
            </ul>
        </nav>

        <main class="main-content">

            <div id="home-page" class="page-container">
                <h2 style="text-align:center">Register Your Account</h2>
                <div style="display:flex; gap:20px; justify-content:center;">
                    <button class="btn" onclick="selectRole('Seller')">I am a Seller</button>
                    <button class="btn" style="background:#555" onclick="selectRole('Buyer')">I am a Buyer</button>
                </div>
            </div>

            <div id="reg-page" class="page-container hidden">
                <h2 id="reg-title">Register</h2>
                <div class="form-row"><label>Full Name</label><input type="text" id="r_name"></div>
                <div class="form-row"><label>Email</label><input type="email" id="r_email"></div>
                <div class="form-row"><label>ID Number</label><input type="text" id="r_id"></div>
                <div class="form-row"><label>Location</label><input type="text" id="r_loc"></div>
                <button class="btn" onclick="goToDashboard()">Complete Registration</button>
            </div>

            <div id="entry-page" class="page-container hidden">
                <h3>New GST Tax Entry</h3>
                <hr><br>
                <div class="form-row"><label>Seller GSTIN</label><input type="text" id="s_gstin"></div>
                <div class="form-row"><label>Buyer GSTIN</label><input type="text" id="b_gstin"></div>
                <div class="form-row"><label>Taxable Value</label><input type="number" id="t_val" oninput="calc()"></div>
                <div class="form-row"><label>GST (18%)</label><input type="text" id="g_val" readonly></div>
                <div class="form-row"><label>Total</label><input type="text" id="tot_val" readonly></div>
                <button class="btn" onclick="sendToDjango()">POST TO BACKEND</button>
            </div>

            <div id="dashboard-page" class="page-container hidden">
                <h2 id="dash-head">Dashboard</h2>
                <div class="card-grid">
                    <div class="card"><p>Total Value</p><h2 id="d-total">₹ 0.00</h2></div>
                    <div class="card"><p>GST Value</p><h2 id="d-gst">₹ 0.00</h2></div>
                </div>
                <div style="background:#eef6ff; padding:15px; border-radius:5px;">
                    <p><strong>Account Holder:</strong> <span id="v-name"></span></p>
                    <p><strong>ID:</strong> <span id="v-id"></span></p>
                </div>
            </div>

        </main>
    </div>

    <script>
        // BACKEND CONFIGURATION
        const API_URL = "http://127.0.0.1:8000/api/invoices/"; 

        function showPage(id) {
            document.querySelectorAll('.page-container').forEach(p => p.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
            if(id === 'dashboard-page' || id === 'entry-page') {
                document.getElementById('sidebar').style.display = 'block';
            }
        }

        function selectRole(role) {
            document.getElementById('reg-title').innerText = "Register as " + role;
            showPage('reg-page');
        }

        function goToDashboard() {
            document.getElementById('v-name').innerText = document.getElementById('r_name').value;
            document.getElementById('v-id').innerText = document.getElementById('r_id').value;
            showPage('dashboard-page');
        }

        function calc() {
            let t = parseFloat(document.getElementById('t_val').value) || 0;
            document.getElementById('g_val').value = (t * 0.18).toFixed(2);
            document.getElementById('tot_val').value = (t * 1.18).toFixed(2);
        }

        // CONNECTING TO DJANGO BACKEND
        async function sendToDjango() {
            const payload = {
                seller_gstin: document.getElementById('s_gstin').value,
                buyer_gstin: document.getElementById('b_gstin').value,
                taxable_value: document.getElementById('t_val').value,
                gst_value: document.getElementById('g_val').value,
                total_value: document.getElementById('tot_val').value
            };

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (response.ok) {
                    alert("Success! Django received the data.");
                    document.getElementById('d-total').innerText = "₹ " + payload.total_value;
                    document.getElementById('d-gst').innerText = "₹ " + payload.gst_value;
                    showPage('dashboard-page');
                } else {
                    alert("Backend Error: " + response.status);
                }
            } catch (error) {
                alert("Connection failed! Make sure Django is running and CORS is installed.");
            }
        }
    </script>
</body>
</html>